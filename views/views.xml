<openerp>
  <data>

    <!-- Comercio -->

    <record id="entidad_form_inherited"  model="ir.ui.view">
      <field name="name">Extension Entidad Form</field>
      <field name="model">financiera.entidad</field>
      <field name="inherit_id" ref="financiera_base.financiera_entidad_form"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='type']" position="after">
          <field name="father_id" domain="[('type', '=', 'comercio')]" attrs="{'invisible': [('type', '!=', 'comercio')]}"/>
          <field name="sucursal_id" domain="[('type', '=', 'sucursal')]" attrs="{'invisible': [('type', '!=', 'comercio')], 'required': [('type', '=', 'comercio')]}"/>
        </xpath>
        <!-- <xpath expr="//page[2]" position="attributes">
          <attribute name="attrs">{'invisible': [('type', '=', 'comercio')]}</attribute>
        </xpath> -->
      </field>
    </record>


    <record model="ir.actions.act_window" id="financiera_comercio_action">
      <field name="name">Comercios</field>
      <field name="res_model">financiera.entidad</field>
      <field name="view_mode">tree,form</field>
      <field name="context">{'default_type': 'comercio'}</field>
      <field name="domain">[('type','=', 'comercio')]</field>
      <field name="view_ids" eval="[(5, 0, 0), 
        (0, 0, {'view_mode': 'tree', 'view_id': ref('financiera_base.financiera_entidad_tree')}),
        (0, 0, {'view_mode': 'form', 'view_id': ref('financiera_base.financiera_entidad_form')})]
        "/>
    </record>

    <menuitem name="Entidades" id="financiera_base.menu_sucursales" web_icon="financiera_base,static/description/entidad.png" groups="financiera_base.manager"/>

    <menuitem name="Comercios" id="menu_comercios_action" parent="financiera_base.menu_sucursales" action="financiera_comercio_action"/>

    <!-- Vista Prestamo Inherited -->

    <record id="financiera_prestamo_tree_inherited"  model="ir.ui.view">
      <field name="name">Extension Prestamo Tree</field>
      <field name="model">financiera.prestamo</field>
      <field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_tree"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='sucursal_id']" position="after">
          <field name="comercio_id" domain="[('type', '=', 'comercio')]"/>
        </xpath>
      </field>
    </record>

    <!-- vista edicion manual tree -->
    <record id="financiera_prestamo_edicion_manual_tree_inherited"  model="ir.ui.view">
      <field name="name">Extension Prestamo Tree</field>
      <field name="model">financiera.prestamo</field>
      <field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_edicion_manual_tree"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='sucursal_id']" position="after">
          <field name="comercio_id" domain="[('type', '=', 'comercio')]"/>
        </xpath>
      </field>
    </record>

    <record id="financiera_prestamo_form_inherited"  model="ir.ui.view">
      <field name="name">Extension Prestamo Form</field>
      <field name="model">financiera.prestamo</field>
      <field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_form"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='sucursal_id']" position="after">
          <field name="comercio_id" domain="[('type', '=', 'comercio')]" readonly="1"/>
        </xpath>
      </field>
    </record>
    
    <!-- Analisis y Reportes -->

    <!-- Graph view Prestamos segun comercio -->

    <record model="ir.ui.view" id="financiera_prestamo_comercio_graph">
      <field name="name">Prestamos segun sucursal</field>
      <field name="model">financiera.prestamo</field>
      <field name="arch" type="xml">
        <graph string="Prestamos" disable_linking="True" type="pie">
          <field name="comercio_id" type="row"/>
          <field name="monto_solicitado" type="measure"/>
        </graph>
      </field>
    </record>

    <record model="ir.actions.act_window" id="financiera_prestamo_comercio_graph_action">
      <field name="name">Prestamos segun sucursal</field>
      <field name="res_model">financiera.prestamo</field>
      <field name="view_mode">graph</field>
      <field name="view_ids" eval="[(5, 0, 0), 
        (0, 0, {'view_mode': 'graph', 'view_id': ref('financiera_prestamo_comercio_graph')})]"/>
    </record>

    <menuitem name="Grafico segun comercio" id="menu_prestamos_graph_comercio_action" sequence="100" parent="financiera_prestamos.menu_prestamos_reportes" action="financiera_prestamo_comercio_graph_action"/>

    <!-- Graph views Cuotas segun comercio -->

    <record id="financiera_prestamo_cuota_comercio_graph" model="ir.ui.view">
      <field name="name">Grafico segun comercio</field>
      <field name="model">financiera.prestamo.cuota</field>
      <field name="arch" type="xml">
        <graph string="Grafico segun comercio" disable_linking="True" type="pie">
          <field name="comercio_id" type="row"/>
          <field name="saldo_store" type="measure"/>
        </graph>
      </field>
    </record>

    <record id="financiera_prestamo_cuota_comercio_graph_action" model="ir.actions.server">
      <field name="name">Grafico segun comercio</field>
      <field name="model_id" ref="model_financiera_prestamo_cuota"/>
      <field name="code">action = self.reporte_graph_comercio_cuotas(cr, uid, context.get('active_ids', []), context=context)</field>
    </record>

    <menuitem name="Grafico segun comercio" id="menu_cuotas_graph_comercio_action" sequence="120" parent="financiera_prestamos.menu_cuotas_reportes" action="financiera_prestamo_cuota_comercio_graph_action"/>

    <!-- Extends Cuota -->

    <record id="financiera_prestamo_cuota_tree_inherited"  model="ir.ui.view">
      <field name="name">Extension Prestamo Cuota Tree</field>
      <field name="model">financiera.prestamo.cuota</field>
      <field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_cuota_tree"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='sucursal_id']" position="after">
          <field name="comercio_id" domain="[('type', '=', 'comercio')]"/>
        </xpath>
      </field>
    </record>


    <record id="financiera_prestamo_cuota_form_inherited"  model="ir.ui.view">
      <field name="name">Extension Prestamo Cuota Form</field>
      <field name="model">financiera.prestamo.cuota</field>
      <field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_cuota_form"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='sucursal_id']" position="after">
          <field name="comercio_id" domain="[('type', '=', 'comercio')]" readonly="1"/>
        </xpath>
      </field>
    </record>

    <!-- PRESTAMOS FILTRADOS -->

    <record id="solicitudes_control_action" model="ir.actions.server">
      <field name="name">Solicitudes</field>
      <field name="model_id" ref="model_financiera_prestamo"/>
      <field name="code">action = self.iniciativas_de_comercio(cr, uid, context.get('active_ids', []), context=context)</field>
    </record>

    <menuitem name="Solicitudes" id="menu_solicitudes" web_icon="financiera_comercio,static/description/solicitud.png" groups="financiera_comercio.user" action="solicitudes_control_action" sequence="10"/>

    <!-- CUOTAS FILTRADOS -->

    <record id="cuotas_control_action" model="ir.actions.server">
      <field name="name">Cuotas</field>
      <field name="model_id" ref="model_financiera_prestamo_cuota"/>
      <field name="code">action = self.cuotas_de_comercio(cr, uid, context.get('active_ids', []), context=context)</field>
    </record>

    <menuitem name="Cuotas" id="menu_cuotas" web_icon="financiera_comercio,static/description/cuotas.png" groups="financiera_comercio.manager" action="cuotas_control_action" sequence="20"/>

    <!-- CONTACTOS FILTRADOS -->

    <record id="comercio_contacts_action" model="ir.actions.server">
      <field name="name">Contactos</field>
      <field name="model_id" ref="model_res_partner"/>
      <field name="code">action = self.comercio_contacts_action(cr, uid, context.get('active_ids', []), context=context)</field>
    </record>

    <menuitem name="Contactos" id="menu_comercio_contacts" web_icon="financiera_comercio,static/description/contactos.png" sequence="2" action="comercio_contacts_action"/>

    <!-- 
    Hacemos invisible el menu Contactos origial
    para ello creamos un grupo sin ususrios y 
    luego se lo asignamos al menu.
     -->
    <record id="make_invisible" model="res.groups">
      <field name="name">Invisible</field>
    </record>

    <record model="ir.ui.menu" id="mail.menu_contacts">
      <field name="groups_id" eval="[(6,0,[ref('make_invisible')])]"/>
    </record>

    <!-- Vista Form Partner -->

    <record id="partner_form_comercio_inherited"  model="ir.ui.view">
      <field name="name">Extension Partner form comercio</field>
      <field name="model">res.partner</field>
      <field name="inherit_id" ref="base.view_partner_form"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='name']" position="after">
          <field name="is_user_login_comercio" invisible="1"/>
        </xpath>
        <xpath expr="//notebook" position="attributes">
          <attribute name="attrs">{'invisible': [('is_user_login_comercio', '=', True)]}</attribute>
        </xpath>
      </field>
    </record>

  </data>
</openerp>