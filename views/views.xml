<openerp>
  <data>

    <!-- Comercio -->

    <record id="entidad_form_inherited"  model="ir.ui.view">
      <field name="name">Extension Entidad Form</field>
      <field name="model">financiera.entidad</field>
      <field name="inherit_id" ref="financiera_base.financiera_entidad_form"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='type']" position="after">
          <field name="father_id" domain="[('type', '=', 'comercio')]" attrs="{'invisible': [('type', '!=', 'comercio')]}"/>
          <field name="sucursal_id" domain="[('type', '=', 'sucursal')]" attrs="{'invisible': [('type', '!=', 'comercio')], 'required': [('type', '=', 'comercio')]}"/>
        </xpath>
        <xpath expr="//page[2]" position="attributes">
          <attribute name="attrs">{'invisible': [('type', '=', 'comercio')]}</attribute>
        </xpath>
      </field>
    </record>


    <record model="ir.actions.act_window" id="financiera_comercio_action">
      <field name="name">Comercios</field>
      <field name="res_model">financiera.entidad</field>
      <field name="view_mode">tree,form</field>
      <field name="context">{'default_type': 'comercio'}</field>
      <field name="domain">[('type','=', 'comercio')]</field>
      <field name="view_ids" eval="[(5, 0, 0), 
        (0, 0, {'view_mode': 'tree', 'view_id': ref('financiera_base.financiera_entidad_tree')}),
        (0, 0, {'view_mode': 'form', 'view_id': ref('financiera_base.financiera_entidad_form')})]
        "/>
    </record>

    <menuitem name="Entidades" id="financiera_base.menu_sucursales" web_icon="financiera_base,static/description/entidad.png" groups="financiera_base.manager"/>

    <menuitem name="Comercios" id="menu_comercios_action" parent="financiera_base.menu_sucursales" action="financiera_comercio_action"/>

    <!-- Vista Prestamo Inherited -->

    <record id="financiera_prestamo_tree_inherited"  model="ir.ui.view">
      <field name="name">Extension Prestamo Tree</field>
      <field name="model">financiera.prestamo</field>
      <field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_tree"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='sucursal_id']" position="after">
          <field name="comercio_id" domain="[('type', '=', 'comercio')]"/>
        </xpath>
      </field>
    </record>

    <record id="financiera_prestamo_form_inherited"  model="ir.ui.view">
      <field name="name">Extension Prestamo Form</field>
      <field name="model">financiera.prestamo</field>
      <field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_form"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='sucursal_id']" position="after">
          <field name="comercio_id" domain="[('type', '=', 'comercio')]" readonly="1"/>
        </xpath>
      </field>
    </record>

    <!-- Extends Cuota -->

    <record id="financiera_prestamo_cuota_tree_inherited"  model="ir.ui.view">
      <field name="name">Extension Prestamo Cuota Tree</field>
      <field name="model">financiera.prestamo.cuota</field>
      <field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_cuota_tree"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='sucursal_id']" position="after">
          <field name="comercio_id" domain="[('type', '=', 'comercio')]"/>
        </xpath>
      </field>
    </record>


    <record id="financiera_prestamo_cuota_form_inherited"  model="ir.ui.view">
      <field name="name">Extension Prestamo Cuota Form</field>
      <field name="model">financiera.prestamo.cuota</field>
      <field name="inherit_id" ref="financiera_prestamos.financiera_prestamo_cuota_form"/>
      <field name="arch" type="xml">        
        <xpath expr="//field[@name='sucursal_id']" position="after">
          <field name="comercio_id" domain="[('type', '=', 'comercio')]" readonly="1"/>
        </xpath>
      </field>
    </record>


    <!-- PRESTAMOS FILTRADOS -->

    <record id="solicitudes_control_action" model="ir.actions.server">
      <field name="name">Solicitudes</field>
      <field name="model_id" ref="model_financiera_prestamo"/>
      <field name="code">action = self.iniciativas_de_comercio(cr, uid, context.get('active_ids', []), context=context)</field>
    </record>

    <menuitem name="Solicitudes" id="menu_solicitudes" web_icon="financiera_comercio,static/description/solicitud.png" groups="financiera_comercio.user" action="solicitudes_control_action" sequence="10"/>

    <!-- CUOTAS FILTRADOS -->

    <record id="cuotas_control_action" model="ir.actions.server">
      <field name="name">Cuotas</field>
      <field name="model_id" ref="model_financiera_prestamo_cuota"/>
      <field name="code">action = self.cuotas_de_comercio(cr, uid, context.get('active_ids', []), context=context)</field>
    </record>

    <menuitem name="Cuotas" id="menu_cuotas" web_icon="financiera_comercio,static/description/cuotas.png" groups="financiera_comercio.manager" action="cuotas_control_action" sequence="20"/>

    <!-- CONTACTOS FILTRADOS -->

    <record id="comercio_contacts_action" model="ir.actions.server">
      <field name="name">Contactos</field>
      <field name="model_id" ref="model_res_partner"/>
      <field name="code">action = self.comercio_contacts_action(cr, uid, context.get('active_ids', []), context=context)</field>
    </record>

    <menuitem name="Contactos" id="menu_comercio_contacts" web_icon="financiera_comercio,static/description/contactos.png" sequence="2" action="comercio_contacts_action"/>

    <!-- 
    Hacemos invisible el menu Contactos origial
    para ello creamos un grupo sin ususrios y 
    luego se lo asignamos al menu.
     -->
    <record id="make_invisible" model="res.groups">
      <field name="name">Invisible</field>
    </record>

    <record model="ir.ui.menu" id="mail.menu_contacts">
      <field name="groups_id" eval="[(6,0,[ref('make_invisible')])]"/>
    </record>

    <!-- Vista Form Partner -->

    <record id="partner_form_comercio_inherited"  model="ir.ui.view">
      <field name="name">Extension Partner form comercio</field>
      <field name="model">res.partner</field>
      <field name="inherit_id" ref="base.view_partner_form"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='name']" position="after">
          <field name="is_user_login_comercio" invisible="1"/>
        </xpath>
        <xpath expr="//notebook" position="attributes">
          <attribute name="attrs">{'invisible': [('is_user_login_comercio', '=', True)]}</attribute>
        </xpath>
      </field>
    </record>


<!--  
    <record model="ir.ui.view" id="filter_financiera_solicitud_tree">
      <field name="name">financiera.solicitud.filter</field>
      <field name="model">financiera.solicitud</field>
      <field name="arch" type="xml">
        <search>
          <filter string="Pendientes" groups="financiera_comercio.manager" name="pendientes" domain="[('state','in', ('send', 'processing'))]"/>
          <separator/>
          <filter string="Mis asignadas" groups="financiera_comercio.manager" name="mis_solicitudes" domain="[('asigned_id','=', uid)]"/>
          <separator/>
          <field name="name"/>
          <field name="partner_id"/>
          <field name="comercio_id"/>
          <field name="asigned_id"/>
          <field name="state"/>
        </search>
      </field>
    </record>
    

 -->

    <!-- Solicitudes - Comercios -->

<!--     <record model="ir.actions.act_window" id="solicitudes_comercio_action">
      <field name="name">Solicitudes a enviar</field>
      <field name="res_model">financiera.solicitud</field>
      <field name="view_mode">tree,form</field>
      <field name="domain">[('create_uid','=', uid)]</field>
      <field name="view_ids" eval="[(5, 0, 0), 
        (0, 0, {'view_mode': 'tree', 'view_id': ref('financiera_solicitud_tree')}),
        (0, 0, {'view_mode': 'form', 'view_id': ref('financiera_solicitud_form')})]
        "/>
    </record>

    <menuitem name="Solicitudes" id="menu_solicitudes_comercios" groups="financiera_comercio.user" action="solicitudes_comercio_action" web_icon="financiera_comercio,static/description/solicitud.png" sequence="20"/>
 -->
  </data>
</openerp>